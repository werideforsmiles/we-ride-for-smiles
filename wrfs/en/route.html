<!DOCTYPE html>
<html lang="en" class="dark-mode">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>The London-Barcelona 2026 Challenge Route - We Ride For Smiles</title>
    <meta name="description" content="Discover the 14 days of the We Ride For Smiles charity cycling challenge, from London to Barcelona. Follow our 1500 km journey day by day on the interactive map.">
    <link rel="canonical" href="https://www.werideforsmiles.org/en/route.html" />

    <meta property="og:title" content="The London-Barcelona 2026 Challenge Route - We Ride For Smiles" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://www.werideforsmiles.org/en/route.html" />
    <meta property="og:image" content="https://www.werideforsmiles.org/assets/hero-background.webp" />
    <meta property="og:description" content="Discover the 14 days of the We Ride For Smiles charity cycling challenge, from London to Barcelona." />
    <meta property="og:site_name" content="We Ride For Smiles" />
    <meta property="og:locale" content="en_GB" />

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="The London-Barcelona 2026 Challenge Route - We Ride For Smiles">
    <meta name="twitter:description" content="Discover the 14 days of the We Ride For Smiles charity cycling challenge, from London to Barcelona.">
    <meta name="twitter:image" content="https://www.werideforsmiles.org/assets/hero-background.webp">

    <link rel="alternate" hreflang="fr" href="https://www.werideforsmiles.org/fr/route.html" />
    <link rel="alternate" hreflang="en" href="https://www.werideforsmiles.org/en/route.html" />
    <link rel="alternate" hreflang="es" href="https://www.werideforsmiles.org/es/route.html" />
    <link rel="alternate" hreflang="x-default" href="https://www.werideforsmiles.org/en/route.html" />
    
    <link rel="icon" href="../assets/wrfs_favicon.webp" type="image/png">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="../css/styles.css" rel="stylesheet" />

    <style>
        :root {
          --font-sans: 'Inter', sans-serif;
          --color-background: #0A0A0A; --color-surface: #191919; --color-text-primary: #FAFAFA;
          --color-text-secondary: #999999; --color-primary: #FFA500; --color-primary-dark: #E59400;
          --color-border: #333333;
        }
        html.light-mode {
          --color-background: #F5F5F5; --color-surface: #FFFFFF; --color-text-primary: #191919;
          --color-text-secondary: #555555; --color-border: #DDDDDD;
        }
        
        .step-content {
            min-height: calc(100vh - 80px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 2rem;
            transition: opacity 0.5s ease-in-out;
            opacity: 0.4;
        }
        .step-content.is-active {
            opacity: 1;
        }
        
        .step-description {
            background-color: rgba(128, 128, 128, 0.05);
            border: 1px solid rgba(128, 128, 128, 0.1);
            padding: 1.5rem;
            border-radius: 12px;
            margin-top: 1rem;
        }
        html.light-mode .step-description {
            border: 1px solid rgba(128, 128, 128, 0.15);
        }
        .step-description p { margin: 0; }
        
        .step-image {
            width: 100%;
            max-height: 400px;
            object-fit: cover;
            border-radius: 12px;
            margin-top: 2rem;
            margin-bottom: 1rem;
        }
        .image-credit {
            font-size: 0.8rem;
            color: var(--color-text-secondary);
            text-align: right;
            margin-top: -0.5rem;
        }
        .image-credit a {
            color: var(--color-text-secondary);
            text-decoration: underline;
        }
        
        @media (max-width: 768px) {
            #map {
                height: 30vh;
                position: sticky;
                top: 80px; 
                z-index: 5;
            }
            .story-container {
                position: relative;
                z-index: 1; 
                background-color: var(--color-background);
            }
            .step-content {
                min-height: calc(70vh - 40px);
                padding: 2rem 1rem;
                margin-top: 40px;
            }
            .step-content:first-child {
                margin-top: 0;
            }
            .step-content h3 {
                font-size: 1.75rem; 
                margin-bottom: 1rem;
            }
            .step-description {
                padding: 1rem;
            }
            .step-image,
            .image-credit {
                display: none; 
            }
        }
    </style>

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebPage",
      "name": "The London-Barcelona 2026 Challenge Route",
      "url": "https://www.werideforsmiles.org/en/route.html",
      "description": "Discover the 14 days of the We Ride For Smiles charity cycling challenge, from London to Barcelona. Follow our 1500 km journey day by day on the interactive map.",
      "isPartOf": {
        "@type": "WebSite",
        "name": "We Ride For Smiles",
        "url": "https://www.werideforsmiles.org/en/index.html"
      }
    }
    </script>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "name": "Home",
        "item": "https://www.werideforsmiles.org/en/index.html"
      },{
        "@type": "ListItem",
        "position": 2,
        "name": "The Route"
      }]
    }
    </script>
</head>

<body class="route-body dark-mode">

    <nav class="navbar" id="navbar">
        <div class="container navbar-content">
            <a href="index.html" class="navbar-brand">WRFS</a>
            <div class="nav-menu">
                <div class="nav-links-desktop">
                    <a href="index.html#mission" class="nav-link">Mission</a>
                    <a href="route.html" class="nav-link">Route</a>
                    <a href="index.html#causes" class="nav-link">Beneficiaries</a>
                    <a href="index.html#team" class="nav-link">The Team</a>
                    <a href="index.html#faq" class="nav-link">FAQ</a>
                    <button class="nav-link-button" data-modal-trigger="newsletter-modal">Newsletter</button>
                    <button class="btn btn-primary" data-modal-trigger="involve-modal" style="margin-left: 1rem;">Get Involved</button>
                </div>
                <div class="nav-controls">
                    <div class="lang-switcher">
                        <span class="selected-lang">EN</span>
                        <ul class="lang-dropdown">
                            <li><a href="../fr/route.html">FR</a></li>
                            <li><a href="../es/route.html">ES</a></li>
                        </ul>
                    </div>
                    <button class="theme-switch" id="theme-toggle" aria-label="Change theme"></button>
                </div>
                <button class="nav-toggle" id="nav-toggle" aria-label="Open menu"><i class="fa-solid fa-bars"></i></button>
            </div>
        </div>
    </nav>
    
    <div class="nav-mobile-overlay" id="nav-mobile-overlay">
        <div class="nav-mobile-header">
            <a href="index.html" class="navbar-brand">WRFS</a>
            <button class="nav-mobile-close" id="nav-mobile-close" aria-label="Close menu"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div class="nav-mobile-links">
            <a href="index.html#mission" class="nav-link">Mission</a>
            <a href="route.html" class="nav-link">Route</a>
            <a href="index.html#causes" class="nav-link">Beneficiaries</a>
            <a href="index.html#team" class="nav-link">The Team</a>
            <a href="index.html#faq" class="nav-link">FAQ</a>
            <button class="nav-link-button" data-modal-trigger="newsletter-modal">Newsletter</button>
            <button class="btn btn-primary" data-modal-trigger="involve-modal">Get Involved</button>
        </div>
    </div>

    <div class="route-container">
        <div id="map"></div>
        
        <div class="story-container">
            <div class="step-content is-active" id="step-0">
                <h3>The Grand Départ</h3>
                <h4>June 2026: London</h4>
                <div class="step-description">
                    <p>The adventure begins in the heart of London. Every pedal stroke is a promise to the children we support.</p>
                </div>
                <img src="https://images.unsplash.com/photo-1513635269975-59663e0ac1ad?q=80&w=1170&auto=format&fit=crop" alt="Aerial photo of London" class="step-image">
                <p class="image-credit">Photo by <a href="https://unsplash.com/@bendavisual" target="_blank">Benjamin Davies</a> on <a href="https://unsplash.com/" target="_blank">Unsplash</a></p>
            </div>
            
            <div class="step-content" id="step-1">
                <h3>Day 1: London → Southampton (130 km)</h4>
                <div class="step-description">
                    <p>First day to get out of the metropolis and reach the great port of Southampton, the boarding gate to France.</p>
                </div>
                <img src="https://images.unsplash.com/photo-1586701749774-bea84f498dd2?q=80&w=1548&auto=format&fit=crop" alt="Port of Southampton" class="step-image">
                <p class="image-credit">Photo by <a href="https://unsplash.com/@karamanh" target="_blank">Hasan Karaman</a> on <a href="https://unsplash.com/" target="_blank">Unsplash</a></p>
            </div>

            <div class="step-content" id="step-2">
                <h3>Day 2: Le Havre → Rouen (90 km)</h4>
                <div class="step-description">
                    <p>After the crossing, a first French stage along the Seine to warm up to the historic city of Rouen.</p>
                </div>
                <img src="https://images.unsplash.com/photo-1713711152826-3abb533ce8a6?q=80&w=1176&auto=format&fit=crop" alt="Urban photo of Rouen" class="step-image">
                <p class="image-credit">Photo by <a href="https://unsplash.com/@barrydtalleyduke3" target="_blank">Barry Talley</a> on <a href="https://unsplash.com/" target="_blank">Unsplash</a></p>
            </div>

            <div class="step-content" id="step-3">
                <h3>Day 3: Rouen → Paris (135 km)</h4>
                <div class="step-description">
                    <p>We follow the meanders of the Seine for a majestic arrival in the capital, at the foot of the Eiffel Tower.</p>
                </div>
                <img src="https://images.unsplash.com/photo-1575544333501-4ab6479b5bcc?q=80&w=1168&auto=format&fit=crop" alt="Photo of the city of Paris" class="step-image">
                <p class="image-credit">Photo by <a href="https://unsplash.com/@idmytro" target="_blank">Dimitri Iakymuk</a> on <a href="https://unsplash.com/" target="_blank">Unsplash</a></p>
            </div>

            <div class="step-content" id="step-4">
                <h3>Day 4: Paris → Orléans (130 km)</h4>
                <div class="step-description">
                    <p>We leave Paris heading south. A smoother ride to reach Orléans and the first castles of the Loire.</p>
                </div>
                 <img src="https://images.unsplash.com/photo-1669834812431-a6605c206c0e?q=80&w=1170&auto=format&fit=crop" alt="Photo of the city of Orléans" class="step-image">
                <p class="image-credit">Photo by <a href="https://unsplash.com/@passimage" target="_blank">Snap Wander</a> on <a href="https://unsplash.com/" target="_blank">Unsplash</a></p>
            </div>
            
            <div class="step-content" id="step-5">
                <h3>Day 5: Rest in Orléans</h3>
                <div class="step-description">
                    <p>After 4 intense days, a well-deserved break to recharge the batteries and explore the city before tackling the center of France.</p>
                </div>
                <img src="https://images.unsplash.com/photo-1652002235810-9d6f452d4e9e?q=80&w=1333&auto=format&fit=crop" alt="Statue of Joan of Arc in Orléans" class="step-image">
                <p class="image-credit">Photo by <a href="https://unsplash.com/@andre_tch" target="_blank">Andre Chipurenko</a> on <a href="https://unsplash.com/" target="_blank">Unsplash</a></p>
            </div>
            
            <div class="step-content" id="step-6">
                <h3>Day 6: Orléans → Châteauroux (150 km)</h4>
                <div class="step-description">
                    <p>We leave the Loire to go deep into the heart of France. A transitional stage through the landscapes of Berry to reach Châteauroux.</p>
                </div>
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a4/Ch%C3%A2teauroux_-_12_rue_de_la_Gare_-_1.jpg/960px-Ch%C3%A2teauroux_-_12_rue_de_la_Gare_-_1.jpg" alt="Photo of a building on rue de la Gare in Châteauroux" class="step-image">
                <p class="image-credit">Photo by <a href="https://commons.wikimedia.org/wiki/User:Benjism89" target="_blank">Benjamin Smith</a> on <a href="https://commons.wikimedia.org" target="_blank">Wikimedia Commons</a></p>
            </div>

            <div class="step-content" id="step-7">
                <h3>Day 7: Châteauroux → Limoges (140 km)</h4>
                <div class="step-description">
                    <p>Heading southwest! The terrain becomes more hilly as we approach the Limousin, a day to test the legs before the foothills of the Massif Central.</p>
                </div>
                <img src="https://images.unsplash.com/photo-1706873556600-7bdf44c2caff?q=80&w=1470&auto=format&fit=crop" alt="Limoges-Bénédictins station" class="step-image">
                <p class="image-credit">Photo by <a href="https://unsplash.com/@getapony" target="_blank">pony</a> on <a href="https://unsplash.com/" target="_blank">Unsplash</a></p>
            </div>

            <div class="step-content" id="step-8">
                <h3>Day 8: Limoges → Brive (100 km)</h4>
                <div class="step-description">
                    <p>A shorter but more nervous stage that takes us towards the Dordogne. The green landscapes welcome us in Brive-la-Gaillarde.</p>
                </div>
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/ec/Brive-la-Gaillarde_-_Place_Latreille_-_1.jpg/960px-Brive-la-Gaillarde_-_Place_Latreille_-_1.jpg" alt="Photo of Place Latreille in Brive-la-Gaillarde" class="step-image">
                <p class="image-credit">Photo by <a href="https://commons.wikimedia.org/wiki/User:Benjism89" target="_blank">Benjamin Smith</a> on <a href="https://commons.wikimedia.org" target="_blank">Wikimedia Commons</a></p>
            </div>

            <div class="step-content" id="step-9">
                <h3>Day 9: Brive → Toulouse (220 km)</h4>
                <div class="step-description">
                    <p>The queen stage of the week! A long day through the Lot to finally reach the Garonne and the magnificent "Pink City", Toulouse.</p>
                </div>
                <img src="https://images.unsplash.com/photo-1576367872882-489d040b9bde?q=80&w=1470&auto=format&fit=crop" alt="Pont Neuf in Toulouse" class="step-image">
                <p class="image-credit">Photo by <a href="https://unsplash.com/@hoangdat302" target="_blank">DAT VO</a> on <a href="https://unsplash.com/" target="_blank">Unsplash</a></p>
            </div>

            <div class="step-content" id="step-10">
                <h3>Day 10: Rest in Toulouse</h3>
                <div class="step-description">
                    <p>Second and last day of rest. The opportunity to stroll along the Canal du Midi, enjoy the atmosphere of the southwest and prepare for the final stretch.</p>
                </div>
                <img src="https://images.unsplash.com/photo-1667515340913-dbdad9c3d7d7?q=80&w=1470&auto=format&fit=crop" alt="Place du Capitole in Toulouse" class="step-image">
                <p class="image-credit">Photo by <a href="https://unsplash.com/@hoangdat302" target="_blank">DAT VO</a> on <a href="https://unsplash.com/" target="_blank">Unsplash</a></p>
            </div>

            <div class="step-content" id="step-11">
                <h3>Day 11: Toulouse → Carcassonne (100 km)</h4>
                <div class="step-description">
                    <p>We follow the Canal du Midi on a flat course. The objective: the majestic medieval city of Carcassonne which stands on the horizon.</p>
                </div>
                <img src="https://images.unsplash.com/photo-1580513860129-dee8825dfe44?q=80&w=1329&auto=format&fit=crop" alt="Medieval city of Carcassonne" class="step-image">
                <p class="image-credit">Photo by <a href="https://unsplash.com/@bonnarda" target="_blank">Alain Bonnardeaux</a> on <a href="https://unsplash.com/" target="_blank">Unsplash</a></p>
            </div>
            
            <div class="step-content" id="step-12">
                <h3>Day 12: Carcassonne → Perpignan (100 km)</h4>
                <div class="step-description">
                    <p>Through the Corbières and its Cathar castles, the route becomes demanding again before plunging towards the Mediterranean and the Catalan capital, Perpignan.</p>
                </div>
                <img src="https://images.unsplash.com/photo-1733670787852-3a2254b178c5?q=80&w=1473&auto=format&fit=crop" alt="Photo of a bridge in Perpignan" class="step-image">
                <p class="image-credit">Photo by <a href="https://unsplash.com/@moondtheartist" target="_blank">Moon D The Artist</a> on <a href="https://unsplash.com/" target="_blank">Unsplash</a></p>
            </div>

            <div class="step-content" id="step-13">
                <h3>Day 13: Perpignan → Girona (115 km)</h4>
                <div class="step-description">
                    <p>That's it, we're crossing the border! The Pyrenees are behind us. Welcome to Spain for this stage to the magnificent Girona.</p>
                </div>
                <img src="https://images.unsplash.com/photo-1515974448560-3e45c9d51f95?q=80&w=1138&auto=format&fit=crop" alt="Colorful houses of Girona" class="step-image">
                <p class="image-credit">Photo by <a href="https://unsplash.com/@lucasgallone" target="_blank">Lucas Gallone</a> on <a href="https://unsplash.com/" target="_blank">Unsplash</a></p>
            </div>

            <div class="step-content" id="step-14">
                <h3>Day 14: Girona → Barcelona (105 km)</h4>
                <div class="step-description">
                    <p>The final stretch! A stage full of emotion, along the Catalan coast, for the grand arrival in Barcelona.</p>
                </div>
                <img src="https://images.unsplash.com/photo-1583422409516-2895a77efded?q=80&w=1170&auto=format&fit=crop" alt="Aerial photo of Barcelona" class="step-image">
                <p class="image-credit">Photo by <a href="https://unsplash.com/@loganstrongarms" target="_blank">Logan Armstrong</a> on <a href="https://unsplash.com/" target="_blank">Unsplash</a></p>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="involve-modal">
        <div class="modal-content">
            <button class="modal-close" data-modal-close>&times;</button>
            <div class="modal-header">
                <h3>Become a driving force of this adventure!</h3>
                <p class="modal-intro">Every bit of help, big or small, on the ground or from a distance, is one more pedal stroke for the children. Find out how you can make a difference.</p>
            </div>
            <form name="get-involved-en-improved" method="POST" data-netlify="true">
                <input type="hidden" name="form-name" value="get-involved-en-improved" />
                <div class="form-row">
                    <div class="form-group">
                        <label for="firstname-involve">First Name</label>
                        <input type="text" id="firstname-involve" name="firstname" placeholder="E.g., John" required>
                    </div>
                    <div class="form-group">
                        <label for="email-involve">Email</label>
                        <input type="email" id="email-involve" name="email" placeholder="E.g., john.doe@email.com" required>
                    </div>
                </div>
                <div class="form-group" style="margin-top: 2.5rem;">
                    <label>How would you like to support us?</label>
                    <div class="involvement-options">
                        <div class="option-card"><input type="checkbox" name="involvement_ride" value="ride" id="role-ride"><label for="role-ride" class="option-label"><div class="option-label-header"><i class="fa-solid fa-bicycle"></i><strong>Ride with us</strong></div><span>Participate in the challenge.</span></label></div>
                        <div class="option-card"><input type="checkbox" name="involvement_event_volunteer" value="event_volunteer" id="role-event"><label for="role-event" class="option-label"><div class="option-label-header"><i class="fa-solid fa-flag-checkered"></i><strong>Volunteer</strong></div><span>Help on the ground.</span></label></div>
                        <div class="option-card"><input type="checkbox" name="involvement_partner" value="partner" id="role-partner"><label for="role-partner" class="option-label"><div class="option-label-header"><i class="fa-solid fa-handshake"></i><strong>Become a partner</strong></div><span>Associate your company.</span></label></div>
                        <div class="option-card"><input type="checkbox" name="involvement_donation" value="donation" id="role-donation"><label for="role-donation" class="option-label"><div class="option-label-header"><i class="fa-solid fa-hand-holding-dollar"></i><strong>Make a donation</strong></div><span>Support financially.</span></label></div>
                        <div class="option-card"><input type="checkbox" name="involvement_remote_volunteer" value="remote_volunteer" id="role-remote"><label for="role-remote" class="option-label"><div class="option-label-header"><i class="fa-solid fa-laptop"></i><strong>Help remotely</strong></div><span>Communication, etc.</span></label></div>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary form-submit-btn" style="width: 100%; margin-top: 1rem;"><span class="btn-text">Send my proposal</span><span class="btn-loader"></span></button>
            </form>
        </div>
    </div>

    <div class="modal-overlay" id="newsletter-modal">
        <div class="modal-content">
            <button class="modal-close" data-modal-close>&times;</button>
            <div class="modal-header">
                <i class="fa-solid fa-envelope-open-text icon-header"></i>
                <h3>Don't miss any of the adventure!</h3>
                <p class="modal-intro">Join our community and receive key updates on the challenge, directly in your inbox.</p>
            </div>
            <form name="newsletter-popup-en-rgpd" method="POST" data-netlify="true">
                <input type="hidden" name="form-name" value="newsletter-popup-en-rgpd" />
                <div class="input-group">
                   <input type="email" name="email" placeholder="Your best email" required>
                   <button type="submit" class="btn btn-primary form-submit-btn"><span class="btn-text">I'm subscribing</span><span class="btn-loader"></span></button>
                </div>
                <label class="custom-checkbox-container">
                    <input type="checkbox" name="consent" id="consent-modal" required>
                    <span class="checkbox-label">I agree to receive news about the project. (<a href="../privacy.html" target="_blank">Privacy Policy</a>)</span>
                </label>
            </form>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
        
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const body = document.body;
            const navbar = document.getElementById('navbar');
            window.addEventListener('scroll', () => navbar?.classList.toggle('scrolled', window.scrollY > 50));

            const navToggle = document.getElementById('nav-toggle');
            const mobileNav = document.getElementById('nav-mobile-overlay');
            const navClose = document.getElementById('nav-mobile-close');
            
            if (navToggle && mobileNav && navClose) {
                const openMobileNav = () => { mobileNav.classList.add('is-active'); body.classList.add('mobile-nav-open'); };
                const closeMobileNav = () => { mobileNav.classList.remove('is-active'); body.classList.remove('mobile-nav-open'); };
                navToggle.addEventListener('click', (e) => { e.stopPropagation(); openMobileNav(); });
                navClose.addEventListener('click', closeMobileNav);
                mobileNav.querySelectorAll('a, button').forEach(link => {
                    link.addEventListener('click', closeMobileNav);
                });
            }

            const modalTriggers = document.querySelectorAll('[data-modal-trigger]');
            const modals = document.querySelectorAll('.modal-overlay');
            const openModal = (modalId) => {
                const modal = document.getElementById(modalId);
                if (modal) { modal.classList.add('is-active'); body.classList.add('modal-open'); }
            };
            const closeModal = (modal) => {
                modal.classList.remove('is-active'); body.classList.remove('modal-open');
            };
            modalTriggers.forEach(trigger => trigger.addEventListener('click', (e) => { e.preventDefault(); e.stopPropagation(); openModal(trigger.dataset.modalTrigger); }));
            modals.forEach(modal => {
                modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(modal); });
                modal.querySelector('[data-modal-close]')?.addEventListener('click', () => closeModal(modal));
            });

            document.querySelectorAll('form[data-netlify="true"]').forEach(form => {
                form.addEventListener('submit', (e) => {
                    const submitBtn = form.querySelector('.form-submit-btn');
                    if (submitBtn) { submitBtn.classList.add('loading'); submitBtn.disabled = true; }
                });
            });

            const themeToggle = document.getElementById('theme-toggle');
            const htmlEl = document.documentElement;
            const sunIconSVG = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>`;
            const moonIconSVG = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>`;
            
            const setTheme = (theme) => {
                htmlEl.className = theme + '-mode route-body';
                localStorage.setItem('theme', theme);
                if (themeToggle) themeToggle.innerHTML = theme === 'dark' ? sunIconSVG : moonIconSVG;
            };
            setTheme(localStorage.getItem('theme') || 'dark');
            
            themeToggle?.addEventListener('click', () => setTheme(htmlEl.classList.contains('dark-mode') ? 'light' : 'dark'));
            
            const map = L.map('map', {
                scrollWheelZoom: false,
                zoomControl: false
            }).setView([47.0, 2.0], 5);

            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
                subdomains: 'abcd',
                maxZoom: 20
            }).addTo(map);
            
            const stepsData = [
                { id: 'step-0', coords: [51.5074, -0.1278], zoom: 12 }, { id: 'step-1', coords: [50.9097, -1.4044], zoom: 12 }, { id: 'step-2', coords: [49.4432, 1.0999], zoom: 12 }, { id: 'step-3', coords: [48.8566, 2.3522], zoom: 11 }, { id: 'step-4', coords: [47.9029, 1.9093], zoom: 12 }, { id: 'step-5', coords: [47.9029, 1.9093], zoom: 13 }, { id: 'step-6', coords: [46.8103, 1.6912], zoom: 12 }, { id: 'step-7', coords: [45.8336, 1.2611], zoom: 12 }, { id: 'step-8', coords: [45.1586, 1.5332], zoom: 12 }, { id: 'step-9', coords: [43.6047, 1.4442], zoom: 12 }, { id: 'step-10', coords: [43.6047, 1.4442], zoom: 13 }, { id: 'step-11', coords: [43.2130, 2.3491], zoom: 12 }, { id: 'step-12', coords: [42.6887, 2.8948], zoom: 12 }, { id: 'step-13', coords: [41.9831, 2.8249], zoom: 12 }, { id: 'step-14', coords: [41.3851, 2.1734], zoom: 12 },
            ];

            const latlngs = stepsData.map(s => s.coords);
            L.polyline(latlngs, { color: '#FFA500', weight: 3, opacity: 0.7 }).addTo(map);

            const allElements = document.querySelectorAll('.step-content');

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const elementId = entry.target.id;
                        const activeStepData = stepsData.find(s => s.id === elementId);

                        if (activeStepData) {
                            map.flyTo(activeStepData.coords, activeStepData.zoom, { animate: true, duration: 1.5 });
                        }
                        
                        allElements.forEach(el => {
                            el.classList.toggle('is-active', el.id === elementId);
                        });
                    }
                });
            }, { threshold: 0.6 });

            allElements.forEach(el => observer.observe(el));
            
            let isScrolling = false;
            const scrollTimeout = 1000;

            const scrollToElement = (index) => {
                if (isScrolling || index < 0 || index >= allElements.length) return;
                isScrolling = true;

                const element = allElements[index];
                const elementTop = element.getBoundingClientRect().top + window.pageYOffset;
                
                let targetPosition;

                if (window.innerWidth <= 768) {
                    const offsetFromViewTop = window.innerHeight * 0.35; 
                    targetPosition = elementTop - offsetFromViewTop;
                } else {
                    const navbarHeight = 80;
                    targetPosition = elementTop - navbarHeight;
                }
                
                window.scrollTo({ top: targetPosition, behavior: 'smooth' });
                setTimeout(() => { isScrolling = false; }, scrollTimeout);
            };

            window.addEventListener('wheel', (event) => {
                if (isScrolling) { event.preventDefault(); return; }
                const currentIndex = Array.from(allElements).findIndex(el => el.classList.contains('is-active'));
                if (event.deltaY > 0 && currentIndex < allElements.length - 1) {
                    event.preventDefault();
                    scrollToElement(currentIndex + 1);
                } else if (event.deltaY < 0 && currentIndex > 0) {
                    event.preventDefault();
                    scrollToElement(currentIndex - 1);
                }
            }, { passive: false });

            let touchStartY = 0;
            window.addEventListener('touchstart', (e) => { touchStartY = e.touches[0].clientY; }, { passive: true });
            window.addEventListener('touchend', (e) => {
                if (isScrolling) return;
                const touchEndY = e.changedTouches[0].clientY;
                const swipeDistance = touchStartY - touchEndY;
                const currentIndex = Array.from(allElements).findIndex(el => el.classList.contains('is-active'));
                if (Math.abs(swipeDistance) > 50) {
                    if (swipeDistance > 0 && currentIndex < allElements.length - 1) {
                        scrollToElement(currentIndex + 1);
                    } else if (swipeDistance < 0 && currentIndex > 0) {
                        scrollToElement(currentIndex - 1);
                    }
                }
            }, { passive: true });
        });
    </script>
</body>
</html>